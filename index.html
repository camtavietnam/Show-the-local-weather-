<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="./style.scss">
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  
</head>
<body>
  <div class="container">
    <div class="wrapper">
      <div class="current">
        <input type="checkbox" id="current__checkbox" checked>
        <div class="current__forecast">
          <p class="current__summary"></p>
          <p class="current__location"></p>
          <p class="current__temp"></p>
        </div>
      </div>
      <div class="next">
        <ul id="next__allForecasts"></ul>
      </div>
    </div> <!--^.wrapper-->
  
    <footer>
      <p class="footer__copyright">
        Playing with <a href="https://dribbble.com/shots/2220362-Weather-UI-Concept" target="_blank">Dribble</a> and <a href="https://darksky.net/poweredby/" target="_blank">DarkSky</a> by Pamcy.
      </p>
    </footer>
  <script type="text/babel">const DOM = {
    $currentSummary: $('.current__summary'),
    $currentLocation: $('.current__location'),
    $currentTemp: $('.current__temp'),
    $currentImage: $('.current'),
    $nextAllForecast: $('#next__allForecasts'),
    $switchButton: $('#current__checkbox'),
}

// Display weather reports
const getWeatherReport = {
    showCurrent(report, location) {
        DOM.$currentSummary.text(`${report.currently.summary}`);
        DOM.$currentLocation.text(`${location.city}`);
        DOM.$currentTemp.text(`${report.currently.temperature.toFixed()}`);
        DOM.$currentImage.css('background-image', `url(https://s3-us-west-2.amazonaws.com/s.cdpn.io/829617/${report.currently.icon}.jpg)`);
    },

    showNext(report) {
        let forecast = '';

        // Convert weekday from unix number to text
        function unixDay(time) {
            const weekdayText = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const now = new Date(time * 1000);
            const weekday = now.getDay();

            return weekdayText[weekday];
        }

        for (let i = 1; i < report.daily.data.length - 4; i += 1) {
            forecast += `<li class="next__forecast">
                            <span class="next__weekday">${unixDay(report.daily.data[i].time)}</span>
                            <span class="next__weatherIcon">
                                <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/829617/${report.daily.data[i].icon}.svg">
                            </span>
                            <span class="next__maxTemp">${report.daily.data[i].temperatureMax.toFixed()}°</span>
                            <span class="next__minTemp">${report.daily.data[i].temperatureMin.toFixed()}°</span>
                        </li>`;
        }

        DOM.$nextAllForecast.html(forecast);
    },
}

// Weather report controller
function weatherController(location) {
    const unit = DOM.$switchButton.prop('checked') ? 'si' : 'us';
    const loc = location.loc.split(',');
    const latitude = loc[0];
    const longitude = loc[1];
    const urlWeather = `https://api.darksky.net/forecast/8f05b9be093e0cbfcd6d645a5eb8a0af/${latitude},${longitude}?units=${unit}&callback=?`;

    // Get weather data from Dark Sky
    $.getJSON(urlWeather, (report) => {
        // console.log(report);
        getWeatherReport.showCurrent(report, location);
        getWeatherReport.showNext(report);
    });
}

// Initialize
function init() {
    const urlIP = 'https://ipinfo.io/json?callback=?';

    // Get IP Location
    $.getJSON(urlIP, (location) => {
        weatherController(location);
    });
}

$(window).on('load', init);
DOM.$switchButton.on('change', init);

</script>
  </div> <!--^.container-->
</body>
</html>
